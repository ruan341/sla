<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delta Airlines RP - Sistema de Licenciamento</title>
    <style>
        /* RESET E CONFIGURAÇÕES GERAIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #001f3f, #003366);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
            background-attachment: fixed;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* HEADER */
        header {
            background: rgba(0, 31, 63, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            border: 3px solid #ff9900;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .logo {
            font-size: 4rem;
            color: #ff9900;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #ffffff, #ff9900);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #88ccff;
            font-size: 1.2rem;
            margin-bottom: 25px;
        }
        
        /* STATUS BAR */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            background: rgba(0, 51, 102, 0.9);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #ff9900;
            margin-top: 20px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .status-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff9900;
        }
        
        /* ABAS */
        .tabs-container {
            background: rgba(0, 31, 63, 0.9);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 153, 0, 0.3);
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 15px 25px;
            background: rgba(0, 51, 102, 0.8);
            border: none;
            border-radius: 10px;
            color: #88ccff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 160px;
        }
        
        .tab-btn:hover {
            background: rgba(255, 153, 0, 0.2);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #ff9900, #ff6600);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 153, 0, 0.3);
        }
        
        .tab-btn.locked {
            background: rgba(136, 204, 255, 0.2);
            color: #6699cc;
            cursor: not-allowed;
        }
        
        /* CONTEÚDO DAS ABAS */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* PAINÉIS */
        .panel {
            background: rgba(0, 31, 63, 0.95);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #ff9900;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
        }
        
        .panel-title {
            font-size: 1.8rem;
            color: #ff9900;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff9900;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* CARDS */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: rgba(0, 51, 102, 0.9);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #ff9900;
            transition: all 0.3s;
            height: 100%;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 153, 0, 0.2);
        }
        
        .card-title {
            font-size: 1.3rem;
            color: #ff9900;
            font-weight: 600;
        }
        
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .badge-pending { background: rgba(255, 153, 0, 0.2); color: #ff9900; }
        .badge-approved { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .badge-rejected { background: rgba(255, 51, 51, 0.2); color: #ff3333; }
        .badge-testing { background: rgba(0, 153, 255, 0.2); color: #0099ff; }
        
        /* FORMULÁRIOS */
        .form-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #88ccff;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 153, 0, 0.2);
            background: rgba(0, 51, 102, 0.8);
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #ff9900;
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.2);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* BOTÕES */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff9900, #ff6600);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 153, 0, 0.3);
        }
        
        .btn-secondary {
            background: rgba(0, 102, 204, 0.8);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #0066cc;
            transform: translateY(-3px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00cc66, #00994d);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff3333, #cc0000);
            color: white;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        /* MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(0, 31, 63, 0.98);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid #ff9900;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ff9900;
        }
        
        .modal-title {
            font-size: 1.8rem;
            color: #ff9900;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #ff9900;
            font-size: 2rem;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }
        
        /* NOTIFICAÇÃO */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 2000;
            display: none;
            animation: slideInRight 0.5s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 153, 0, 0.3);
            max-width: 400px;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.success { background: rgba(0, 204, 102, 0.9); }
        .notification.error { background: rgba(255, 51, 51, 0.9); }
        .notification.info { background: rgba(255, 153, 0, 0.9); }
        
        /* CHAT */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 500px;
            background: rgba(0, 51, 102, 0.9);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255, 153, 0, 0.2);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: 15px;
            word-wrap: break-word;
        }
        
        .message.admin {
            align-self: flex-end;
            background: linear-gradient(135deg, #ff9900, #ff6600);
            border: 1px solid rgba(255, 153, 0, 0.3);
        }
        
        .message.pilot {
            align-self: flex-start;
            background: rgba(0, 102, 204, 0.8);
            border: 1px solid rgba(0, 102, 204, 0.3);
        }
        
        /* TABELAS */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 2px solid rgba(255, 153, 0, 0.2);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 51, 102, 0.9);
        }
        
        .table th {
            background: rgba(0, 31, 63, 0.9);
            padding: 15px;
            text-align: left;
            color: #ff9900;
            font-weight: 600;
            border-bottom: 2px solid #ff9900;
        }
        
        .table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 153, 0, 0.1);
            color: #88ccff;
        }
        
        /* RESPONSIVO */
        @media (max-width: 1200px) {
            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: 100%;
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .status-bar {
                grid-template-columns: 1fr;
            }
            
            .panel {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px;
            }
            
            .logo {
                font-size: 3rem;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- NOTIFICAÇÃO -->
    <div id="notification" class="notification"></div>
    
    <!-- MODAL DE LOGIN -->
    <div id="loginModal" class="modal-overlay" style="display: flex;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-lock"></i> LOGIN DELTA AIRLINES</h2>
                <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <div class="form-container">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> E-mail ou ID de Piloto</label>
                    <input type="text" id="loginEmail" class="form-control" placeholder="seu@email.com ou DL-001">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-key"></i> Senha</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Digite sua senha">
                </div>
                <div class="form-group" id="adminCodeGroup" style="display: none;">
                    <label><i class="fas fa-shield-alt"></i> Código Administrativo</label>
                    <input type="password" id="adminCode" class="form-control" placeholder="Somente para administradores">
                </div>
                <div class="form-group" style="text-align: center; margin-top: 25px;">
                    <button class="btn btn-secondary" onclick="toggleLoginMode()" style="margin-bottom: 15px;">
                        <i class="fas fa-exchange-alt"></i> 
                        <span id="loginModeText">Modo Piloto</span>
                    </button>
                    <button class="btn btn-primary" onclick="attemptLogin()" style="width: 100%; padding: 15px;">
                        <i class="fas fa-rocket"></i> ENTRAR NO SISTEMA
                    </button>
                </div>
                <div style="text-align: center; margin-top: 25px; color: #88ccff;">
                    <p>Não tem conta? <a href="#" onclick="showModal('registerModal')" style="color: #ff9900; font-weight: bold;">Cadastre-se como piloto</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL DE CADASTRO -->
    <div id="registerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-user-plus"></i> CADASTRO DE PILOTO</h2>
                <button class="modal-close" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <div class="form-container">
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> Nome Completo</label>
                    <input type="text" id="registerName" class="form-control" placeholder="Seu nome completo">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-envelope"></i> E-mail</label>
                        <input type="email" id="registerEmail" class="form-control" placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-phone"></i> WhatsApp</label>
                        <input type="tel" id="registerWhatsApp" class="form-control" placeholder="(11) 99999-9999">
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-gamepad"></i> Usuário Roblox</label>
                    <input type="text" id="registerRoblox" class="form-control" placeholder="Seu nome no Roblox">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-birthday-cake"></i> Idade</label>
                        <input type="number" id="registerAge" class="form-control" placeholder="18" min="16" max="100">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-globe-americas"></i> Nacionalidade</label>
                        <input type="text" id="registerNationality" class="form-control" placeholder="Brasileiro">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-lock"></i> Senha</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="Mínimo 6 caracteres">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-lock"></i> Confirmar Senha</label>
                        <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Digite novamente">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="registerPilot()" style="width: 100%; padding: 15px;">
                    <i class="fas fa-check-circle"></i> CADASTRAR-SE COMO PILOTO
                </button>
            </div>
        </div>
    </div>
    
    <!-- MODAL DO TESTE -->
    <div id="testModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-vial"></i> TESTE DE PILOTAGEM</h2>
                <button class="modal-close" onclick="closeModal('testModal')">&times;</button>
            </div>
            <div id="testContent"></div>
        </div>
    </div>
    
    <!-- CONTEÚDO PRINCIPAL (APÓS LOGIN) -->
    <div id="mainContent" style="display: none;">
        <div class="container">
            <!-- HEADER -->
            <header>
                <div class="logo-container">
                    <div class="logo">✈️</div>
                    <div>
                        <h1>DELTA AIRLINES RP</h1>
                        <p class="subtitle">Sistema de Licenciamento e Gerenciamento de Pilotos</p>
                    </div>
                </div>
                
                <div class="status-bar">
                    <div class="status-item">
                        <i class="fas fa-user"></i>
                        <span>Piloto: <span class="status-value" id="headerPilotName">-</span></span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-id-badge"></i>
                        <span>ID: <span class="status-value" id="headerPilotId">-</span></span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-chart-line"></i>
                        <span>Pontuação: <span class="status-value" id="headerPilotScore">0</span></span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <button class="btn btn-danger btn-small" onclick="logout()">Sair</button>
                    </div>
                </div>
            </header>
            
            <!-- ABAS -->
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="tab-btn" data-tab="flights">
                        <i class="fas fa-plane"></i> Meus Voos
                    </button>
                    <button class="tab-btn" data-tab="tests">
                        <i class="fas fa-vial"></i> Testes
                    </button>
                    <button class="tab-btn" data-tab="license">
                        <i class="fas fa-id-card"></i> Minha Carteira
                    </button>
                    <button class="tab-btn" data-tab="chat">
                        <i class="fas fa-comments"></i> Chat
                    </button>
                    <button class="tab-btn locked" id="adminTabBtn" data-tab="admin">
                        <i class="fas fa-user-shield"></i> Painel Admin
                    </button>
                </div>
            </div>
            
            <!-- CONTEÚDO DAS ABAS -->
            
            <!-- DASHBOARD -->
            <div id="dashboard" class="tab-content active">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-tachometer-alt"></i> DASHBOARD DO PILOTO</h2>
                    
                    <div class="cards-grid">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Status Atual</div>
                                <div class="badge" id="statusBadge">PENDENTE</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <p><i class="fas fa-user"></i> <strong>Nome:</strong> <span id="dashboardName">-</span></p>
                                <p><i class="fas fa-id-badge"></i> <strong>ID:</strong> <span id="dashboardId">-</span></p>
                                <p><i class="fas fa-layer-group"></i> <strong>Nível:</strong> <span id="dashboardLevel">Aprendiz</span></p>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Estatísticas</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <p><i class="fas fa-plane"></i> <strong>Voos Completos:</strong> <span id="statsFlights">0</span></p>
                                <p><i class="fas fa-vial"></i> <strong>Testes Realizados:</strong> <span id="statsTests">0</span></p>
                                <p><i class="fas fa-star"></i> <strong>Pontuação Total:</strong> <span id="statsScore">0</span></p>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Próximos Voos</div>
                            </div>
                            <div id="upcomingFlights" style="margin-top: 15px;">
                                <p style="color: #88ccff; text-align: center;">Nenhum voo agendado</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- VOOS -->
            <div id="flights" class="tab-content">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-plane"></i> MEUS VOOS</h2>
                    
                    <div style="margin-bottom: 25px;">
                        <button class="btn btn-primary" onclick="refreshFlights()">
                            <i class="fas fa-sync-alt"></i> Atualizar Voos
                        </button>
                        <button class="btn btn-secondary" onclick="showAvailableFlights()">
                            <i class="fas fa-calendar-plus"></i> Ver Voos Disponíveis
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Voo</th>
                                    <th>Rota</th>
                                    <th>Data/Hora</th>
                                    <th>Aeronave</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="flightsTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px; color: #88ccff;">
                                        Nenhum voo encontrado
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- TESTES -->
            <div id="tests" class="tab-content">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-vial"></i> TESTES DE PILOTAGEM</h2>
                    
                    <div id="testSection">
                        <div class="card" style="text-align: center; padding: 40px;">
                            <i class="fas fa-vial" style="font-size: 4rem; color: #ff9900; margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">AGUARDANDO TESTE</h3>
                            <p style="color: #88ccff; margin-bottom: 25px;">
                                Aguarde um administrador liberar seu teste de pilotagem.
                                Você será notificado quando estiver disponível.
                            </p>
                            <button class="btn btn-primary" onclick="checkForTest()">
                                <i class="fas fa-search"></i> VERIFICAR SE HÁ TESTE DISPONÍVEL
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CARTEIRA -->
            <div id="license" class="tab-content">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-id-card"></i> MINHA CARTEIRA DE PILOTO</h2>
                    
                    <div class="cards-grid">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Carteira Digital</div>
                            </div>
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 4rem; color: #ff9900; margin-bottom: 20px;">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <h3 style="margin-bottom: 10px;" id="licenseCardName">-</h3>
                                <p><strong>ID:</strong> <span id="licenseCardId">-</span></p>
                                <p><strong>Categoria:</strong> <span id="licenseCardCategory">-</span></p>
                                <p><strong>Validade:</strong> <span id="licenseCardExpiry">-</span></p>
                            </div>
                            <div style="margin-top: 20px;">
                                <button class="btn btn-primary" onclick="viewLicense()" style="width: 100%;">
                                    <i class="fas fa-eye"></i> VER CARTEIRA COMPLETA
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Links Importantes</div>
                            </div>
                            <div style="margin-top: 20px;">
                                <div style="margin-bottom: 15px;">
                                    <button class="btn btn-primary" style="width: 100%; text-align: left;" onclick="joinServer()">
                                        <i class="fas fa-gamepad"></i> Servidor Roblox
                                    </button>
                                </div>
                                <div>
                                    <button class="btn btn-success" style="width: 100%; text-align: left;" onclick="joinWhatsApp()">
                                        <i class="fab fa-whatsapp"></i> Grupo WhatsApp
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CHAT -->
            <div id="chat" class="tab-content">
                <div class="panel">
                    <h2 class="panel-title"><i class="fas fa-comments"></i> CHAT COM ADMINISTRAÇÃO</h2>
                    
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="message admin">
                                <strong>Administração:</strong> Olá! Bem-vindo ao sistema Delta Airlines RP. Como posso ajudá-lo hoje?
                            </div>
                        </div>
                        <div style="padding: 15px; background: rgba(0, 31, 63, 0.9); border-top: 2px solid rgba(255, 153, 0, 0.2);">
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="chatInput" class="form-control" placeholder="Digite sua mensagem..." style="flex: 1;">
                                <button class="btn btn-primary" onclick="sendChatMessage()">
                                    <i class="fas fa-paper-plane"></i> Enviar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PAINEL ADMIN -->
            <div id="admin" class="tab-content">
                <div class="panel">
                    <div id="adminLoginPrompt" style="text-align: center; padding: 50px;">
                        <i class="fas fa-lock" style="font-size: 5rem; color: #ff9900; margin-bottom: 20px;"></i>
                        <h2 style="margin-bottom: 15px;">ÁREA RESTRITA</h2>
                        <p style="color: #88ccff; margin-bottom: 25px;">
                            Esta área requer autenticação administrativa
                        </p>
                        <button class="btn btn-primary" onclick="showAdminLogin()">
                            <i class="fas fa-sign-in-alt"></i> FAZER LOGIN COMO ADMIN
                        </button>
                    </div>
                    
                    <div id="adminContent" style="display: none;">
                        <h2 class="panel-title"><i class="fas fa-user-shield"></i> PAINEL DE ADMINISTRAÇÃO</h2>
                        
                        <!-- SUB-ABAS DO ADMIN -->
                        <div class="tabs-container" style="margin-bottom: 25px;">
                            <div class="tabs">
                                <button class="tab-btn active" data-subtab="dashboard">
                                    <i class="fas fa-tachometer-alt"></i> Dashboard
                                </button>
                                <button class="tab-btn" data-subtab="pilots">
                                    <i class="fas fa-users"></i> Pilotos
                                </button>
                                <button class="tab-btn" data-subtab="tests">
                                    <i class="fas fa-vial"></i> Testes
                                </button>
                                <button class="tab-btn" data-subtab="flights">
                                    <i class="fas fa-plane"></i> Voos
                                </button>
                            </div>
                        </div>
                        
                        <!-- DASHBOARD ADMIN -->
                        <div id="adminDashboard" class="admin-subtab active">
                            <div class="cards-grid">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Estatísticas</div>
                                    </div>
                                    <div style="margin-top: 15px;">
                                        <p><i class="fas fa-users"></i> <strong>Total de Pilotos:</strong> <span id="adminTotalPilots">0</span></p>
                                        <p><i class="fas fa-vial"></i> <strong>Testes Pendentes:</strong> <span id="adminPendingTests">0</span></p>
                                        <p><i class="fas fa-plane"></i> <strong>Voos Agendados:</strong> <span id="adminScheduledFlights">0</span></p>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Ações Rápidas</div>
                                    </div>
                                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                                        <button class="btn btn-primary" onclick="switchAdminTab('pilots')">
                                            <i class="fas fa-users"></i> Gerenciar Pilotos
                                        </button>
                                        <button class="btn btn-secondary" onclick="showModal('createFlightModal')">
                                            <i class="fas fa-plane"></i> Agendar Voo
                                        </button>
                                        <button class="btn btn-success" onclick="createTest()">
                                            <i class="fas fa-vial"></i> Criar Teste
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- GERENCIAR PILOTOS -->
                        <div id="adminPilots" class="admin-subtab" style="display: none;">
                            <div style="margin-bottom: 20px;">
                                <h3 style="color: #ff9900; margin-bottom: 15px;">Todos os Pilotos</h3>
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Nome</th>
                                                <th>Status</th>
                                                <th>Pontuação</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminPilotsTable">
                                            <!-- Dados carregados via JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- GERENCIAR TESTES -->
                        <div id="adminTests" class="admin-subtab" style="display: none;">
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h3 style="color: #ff9900;">Gerenciar Testes</h3>
                                    <button class="btn btn-primary" onclick="createTest()">
                                        <i class="fas fa-plus"></i> Criar Novo Teste
                                    </button>
                                </div>
                                <div id="adminTestsList">
                                    <!-- Testes carregados via JS -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- GERENCIAR VOOS -->
                        <div id="adminFlights" class="admin-subtab" style="display: none;">
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h3 style="color: #ff9900;">Gerenciar Voos</h3>
                                    <button class="btn btn-primary" onclick="showModal('createFlightModal')">
                                        <i class="fas fa-plus"></i> Agendar Novo Voo
                                    </button>
                                </div>
                                <div id="adminFlightsList">
                                    <!-- Voos carregados via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURAÇÃO ====================
        const CONFIG = {
            ADMIN_CODE: "DeltaAdmin2024!",
            STORAGE_KEY: "delta_airlines_rp_v2",
            WHATSAPP_LINK: "https://chat.whatsapp.com/IGETya2bgepDxqirxXwFPQ",
            ROBLOX_LINK: "https://www.roblox.com/share?code=d05a3163e2a0794480d4f23e122c1504&type=Server",
            VERSION: "2.0"
        };
        
        // ==================== SISTEMA DE DADOS ====================
        class DataManager {
            constructor() {
                this.loadAllData();
            }
            
            loadAllData() {
                try {
                    this.pilots = JSON.parse(localStorage.getItem(`${CONFIG.STORAGE_KEY}_pilots`)) || {};
                    this.flights = JSON.parse(localStorage.getItem(`${CONFIG.STORAGE_KEY}_flights`)) || [];
                    this.tests = JSON.parse(localStorage.getItem(`${CONFIG.STORAGE_KEY}_tests`)) || {};
                    this.chat = JSON.parse(localStorage.getItem(`${CONFIG.STORAGE_KEY}_chat`)) || [];
                    this.session = JSON.parse(localStorage.getItem(`${CONFIG.STORAGE_KEY}_session`)) || null;
                    
                    // Inicializar dados de exemplo se vazio
                    if (Object.keys(this.pilots).length === 0) {
                        this.initializeSampleData();
                    }
                } catch (error) {
                    console.error("Erro ao carregar dados:", error);
                    this.resetData();
                }
            }
            
            saveAllData() {
                try {
                    localStorage.setItem(`${CONFIG.STORAGE_KEY}_pilots`, JSON.stringify(this.pilots));
                    localStorage.setItem(`${CONFIG.STORAGE_KEY}_flights`, JSON.stringify(this.flights));
                    localStorage.setItem(`${CONFIG.STORAGE_KEY}_tests`, JSON.stringify(this.tests));
                    localStorage.setItem(`${CONFIG.STORAGE_KEY}_chat`, JSON.stringify(this.chat));
                    if (this.session) {
                        localStorage.setItem(`${CONFIG.STORAGE_KEY}_session`, JSON.stringify(this.session));
                    }
                } catch (error) {
                    console.error("Erro ao salvar dados:", error);
                }
            }
            
            resetData() {
                this.pilots = {};
                this.flights = [];
                this.tests = {};
                this.chat = [];
                this.session = null;
                this.saveAllData();
            }
            
            initializeSampleData() {
                // Pilotos de exemplo
                this.pilots = {
                    "DL-001": {
                        id: "DL-001",
                        name: "João Silva",
                        email: "joao@exemplo.com",
                        whatsapp: "(11) 99999-9999",
                        roblox: "PilotJoao",
                        age: 25,
                        nationality: "Brasileiro",
                        password: "123456",
                        score: 150,
                        level: "Piloto Jr",
                        status: "approved",
                        flights: [],
                        tests: [],
                        licenseExpiry: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    },
                    "DL-002": {
                        id: "DL-002",
                        name: "Maria Santos",
                        email: "maria@exemplo.com",
                        whatsapp: "(11) 98888-8888",
                        roblox: "PilotMaria",
                        age: 22,
                        nationality: "Brasileira",
                        password: "123456",
                        score: 0,
                        level: "Aprendiz",
                        status: "pending",
                        flights: [],
                        tests: [],
                        licenseExpiry: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    }
                };
                
                // Voos de exemplo
                this.flights = [
                    {
                        id: "FL001",
                        number: "DL101",
                        origin: "SBGR - Guarulhos",
                        destination: "KJFK - Nova York",
                        date: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                        time: "14:30",
                        aircraft: "Boeing 777-300ER",
                        status: "available",
                        pilotId: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: "FL002",
                        number: "DL202",
                        origin: "SBSP - Congonhas",
                        destination: "SBGL - Galeão",
                        date: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString(),
                        time: "09:00",
                        aircraft: "Airbus A320",
                        status: "scheduled",
                        pilotId: "DL-001",
                        createdAt: new Date().toISOString()
                    }
                ];
                
                // Testes de exemplo
                this.tests = {
                    "T001": {
                        id: "T001",
                        name: "Teste Básico de Pilotagem",
                        questions: 10,
                        passingScore: 7,
                        status: "template",
                        createdAt: new Date().toISOString()
                    }
                };
                
                // Chat de exemplo
                this.chat = [
                    {
                        id: "MSG001",
                        sender: "admin",
                        pilotId: "DL-001",
                        message: "Olá! Bem-vindo ao sistema Delta Airlines RP.",
                        timestamp: new Date().toISOString()
                    }
                ];
                
                this.saveAllData();
            }
        }
        
        // ==================== SISTEMA PRINCIPAL ====================
        class DeltaAirlinesSystem {
            constructor() {
                this.data = new DataManager();
                this.currentUser = null;
                this.isAdmin = false;
                this.currentTest = null;
                this.init();
            }
            
            init() {
                this.checkSession();
                this.setupEventListeners();
                this.showNotification("Sistema Delta Airlines RP inicializado!", "info");
            }
            
            checkSession() {
                if (this.data.session && this.data.session.expires > Date.now()) {
                    if (this.data.session.isAdmin) {
                        this.loginAsAdmin(this.data.session.email);
                    } else {
                        const pilot = this.data.pilots[this.data.session.userId];
                        if (pilot) {
                            this.loginAsPilot(pilot);
                        }
                    }
                } else {
                    this.showLoginModal();
                }
            }
            
            showLoginModal() {
                this.showModal('loginModal');
            }
            
            loginAsAdmin(email) {
                this.currentUser = {
                    id: "ADMIN",
                    name: "Administrador Delta",
                    email: email,
                    isAdmin: true
                };
                this.isAdmin = true;
                
                this.saveSession();
                this.showMainContent();
                this.unlockAdminPanel();
                this.showNotification("✅ Login administrativo realizado!", "success");
            }
            
            loginAsPilot(pilot) {
                this.currentUser = pilot;
                this.isAdmin = false;
                
                // Atualizar último login
                pilot.lastLogin = new Date().toISOString();
                this.data.pilots[pilot.id] = pilot;
                
                this.saveSession();
                this.showMainContent();
                this.updateDashboard();
                this.showNotification(`✅ Bem-vindo, ${pilot.name}!`, "success");
            }
            
            saveSession() {
                this.data.session = {
                    userId: this.currentUser.id,
                    email: this.currentUser.email,
                    password: this.currentUser.password,
                    isAdmin: this.isAdmin,
                    expires: Date.now() + (7 * 24 * 60 * 60 * 1000) // 7 dias
                };
                this.data.saveAllData();
            }
            
            showMainContent() {
                this.hideModal('loginModal');
                document.getElementById('mainContent').style.display = 'block';
                
                // Atualizar informações do usuário
                this.updateUserInfo();
                
                // Inicializar abas
                this.setupTabs();
            }
            
            updateUserInfo() {
                if (!this.currentUser) return;
                
                const elements = ['headerPilotName', 'headerPilotId', 'headerPilotScore', 
                                 'dashboardName', 'dashboardId', 'licenseCardName', 'licenseCardId'];
                
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (id.includes('Name')) element.textContent = this.currentUser.name;
                        if (id.includes('Id')) element.textContent = this.currentUser.id;
                        if (id.includes('Score')) element.textContent = this.currentUser.score || '0';
                    }
                });
                
                // Status badge
                const statusBadge = document.getElementById('statusBadge');
                if (statusBadge) {
                    statusBadge.textContent = this.currentUser.status === 'approved' ? 'APROVADO' :
                                             this.currentUser.status === 'pending' ? 'PENDENTE' :
                                             this.currentUser.status === 'testing' ? 'EM TESTE' : 'REPROVADO';
                    statusBadge.className = this.currentUser.status === 'approved' ? 'badge badge-approved' :
                                           this.currentUser.status === 'pending' ? 'badge badge-pending' :
                                           this.currentUser.status === 'testing' ? 'badge badge-testing' : 'badge badge-rejected';
                }
                
                // Nível
                const levelElement = document.getElementById('dashboardLevel');
                if (levelElement) {
                    levelElement.textContent = this.currentUser.level || 'Aprendiz';
                }
                
                // Carteira
                const licenseCategory = document.getElementById('licenseCardCategory');
                const licenseExpiry = document.getElementById('licenseCardExpiry');
                if (licenseCategory) licenseCategory.textContent = this.currentUser.level || 'Aprendiz';
                if (licenseExpiry && this.currentUser.licenseExpiry) {
                    licenseExpiry.textContent = new Date(this.currentUser.licenseExpiry).toLocaleDateString('pt-BR');
                }
            }
            
            updateDashboard() {
                if (!this.currentUser || this.isAdmin) return;
                
                // Estatísticas
                const completedFlights = this.currentUser.flights?.filter(f => f.status === 'completed').length || 0;
                const completedTests = this.currentUser.tests?.filter(t => t.completed).length || 0;
                
                document.getElementById('statsFlights').textContent = completedFlights;
                document.getElementById('statsTests').textContent = completedTests;
                document.getElementById('statsScore').textContent = this.currentUser.score || '0';
                
                // Próximos voos
                this.loadUpcomingFlights();
                
                // Testes pendentes
                this.checkPendingTests();
            }
            
            logout() {
                this.currentUser = null;
                this.isAdmin = false;
                this.data.session = null;
                this.data.saveAllData();
                
                document.getElementById('mainContent').style.display = 'none';
                this.showLoginModal();
                this.showNotification("👋 Logout realizado com sucesso", "info");
            }
            
            // ==================== SISTEMA DE NOTIFICAÇÕES ====================
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                if (!notification) return;
                
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 4000);
                
                console.log(`📢 ${type.toUpperCase()}: ${message}`);
            }
            
            // ==================== SISTEMA DE MODAIS ====================
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                }
            }
            
            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                }
            }
            
            // ==================== SISTEMA DE ABAS ====================
            setupTabs() {
                // Abas principais
                document.querySelectorAll('.tab-btn:not(.locked)').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabId = e.currentTarget.dataset.tab;
                        this.switchTab(tabId);
                    });
                });
                
                // Sub-abas do admin
                document.querySelectorAll('[data-subtab]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const subtabId = e.currentTarget.dataset.subtab;
                        this.switchAdminTab(subtabId);
                    });
                });
                
                // Ativar aba inicial
                this.switchTab('dashboard');
            }
            
            switchTab(tabId) {
                if (tabId === 'admin' && !this.isAdmin) {
                    this.showAdminLogin();
                    return;
                }
                
                // Esconder todas as abas
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Remover active dos botões
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Mostrar aba selecionada
                const tabElement = document.getElementById(tabId);
                if (tabElement) {
                    tabElement.classList.add('active');
                }
                
                // Ativar botão
                const tabBtn = document.querySelector(`[data-tab="${tabId}"]`);
                if (tabBtn) {
                    tabBtn.classList.add('active');
                }
                
                // Carregar conteúdo
                switch(tabId) {
                    case 'dashboard':
                        this.updateDashboard();
                        break;
                    case 'flights':
                        this.loadPilotFlights();
                        break;
                    case 'tests':
                        this.loadPilotTests();
                        break;
                    case 'chat':
                        this.loadChat();
                        break;
                    case 'admin':
                        if (this.isAdmin) this.loadAdminPanel();
                        break;
                }
            }
            
            switchAdminTab(subtabId) {
                // Esconder todas sub-abas
                document.querySelectorAll('.admin-subtab').forEach(tab => {
                    tab.style.display = 'none';
                });
                
                // Remover active dos botões
                document.querySelectorAll('[data-subtab]').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Mostrar sub-aba
                const element = document.getElementById(`admin${subtabId.charAt(0).toUpperCase() + subtabId.slice(1)}`);
                if (element) {
                    element.style.display = 'block';
                }
                
                // Ativar botão
                const btn = document.querySelector(`[data-subtab="${subtabId}"]`);
                if (btn) {
                    btn.classList.add('active');
                }
                
                // Carregar conteúdo
                if (this.isAdmin) {
                    switch(subtabId) {
                        case 'dashboard':
                            this.loadAdminDashboard();
                            break;
                        case 'pilots':
                            this.loadAdminPilots();
                            break;
                        case 'tests':
                            this.loadAdminTests();
                            break;
                        case 'flights':
                            this.loadAdminFlights();
                            break;
                    }
                }
            }
            
            // ==================== FUNÇÕES DO PILOTO ====================
            loadPilotFlights() {
                if (!this.currentUser || this.isAdmin) return;
                
                const pilotFlights = this.data.flights.filter(f => f.pilotId === this.currentUser.id);
                const table = document.getElementById('flightsTable');
                
                if (!table) return;
                
                if (pilotFlights.length === 0) {
                    table.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #88ccff;">
                                Nenhum voo encontrado
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                table.innerHTML = pilotFlights.map(flight => `
                    <tr>
                        <td>${flight.number}</td>
                        <td>${flight.origin} → ${flight.destination}</td>
                        <td>${new Date(flight.date).toLocaleDateString('pt-BR')} ${flight.time}</td>
                        <td>${flight.aircraft}</td>
                        <td>
                            <span class="badge ${flight.status === 'completed' ? 'badge-approved' : 
                                            flight.status === 'cancelled' ? 'badge-rejected' : 'badge-pending'}">
                                ${flight.status === 'completed' ? 'COMPLETO' : 
                                 flight.status === 'cancelled' ? 'CANCELADO' : 'AGENDADO'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-small btn-primary" onclick="system.viewFlightDetails('${flight.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
            
            loadUpcomingFlights() {
                if (!this.currentUser || this.isAdmin) return;
                
                const upcoming = this.data.flights
                    .filter(f => f.pilotId === this.currentUser.id && f.status === 'scheduled')
                    .slice(0, 3);
                
                const container = document.getElementById('upcomingFlights');
                if (!container) return;
                
                if (upcoming.length === 0) {
                    container.innerHTML = '<p style="color: #88ccff; text-align: center;">Nenhum voo agendado</p>';
                    return;
                }
                
                container.innerHTML = upcoming.map(flight => `
                    <div style="background: rgba(0, 51, 102, 0.5); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <p style="font-weight: bold;">✈️ ${flight.number}</p>
                        <p>${flight.origin} → ${flight.destination}</p>
                        <p>${new Date(flight.date).toLocaleDateString('pt-BR')} ${flight.time}</p>
                    </div>
                `).join('');
            }
            
            checkPendingTests() {
                if (!this.currentUser || this.isAdmin) return;
                
                const pendingTest = Object.values(this.data.tests).find(t => 
                    t.pilotId === this.currentUser.id && t.status === 'pending'
                );
                
                const testSection = document.getElementById('testSection');
                if (!testSection) return;
                
                if (pendingTest) {
                    testSection.innerHTML = `
                        <div class="card" style="text-align: center; padding: 40px;">
                            <i class="fas fa-vial" style="font-size: 4rem; color: #ff9900; margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 15px;">TESTE DISPONÍVEL!</h3>
                            <p style="color: #88ccff; margin-bottom: 25px;">
                                Você tem um teste de <strong>${pendingTest.name}</strong> para realizar.
                            </p>
                            <button class="btn btn-primary" onclick="system.startTest('${pendingTest.id}')">
                                <i class="fas fa-play"></i> INICIAR TESTE
                            </button>
                        </div>
                    `;
                }
            }
            
            loadPilotTests() {
                this.checkPendingTests();
            }
            
            // ==================== SISTEMA ADMIN ====================
            unlockAdminPanel() {
                const adminTabBtn = document.getElementById('adminTabBtn');
                if (adminTabBtn) {
                    adminTabBtn.classList.remove('locked');
                }
                
                const adminLoginPrompt = document.getElementById('adminLoginPrompt');
                const adminContent = document.getElementById('adminContent');
                
                if (adminLoginPrompt) adminLoginPrompt.style.display = 'none';
                if (adminContent) adminContent.style.display = 'block';
                
                this.loadAdminPanel();
            }
            
            loadAdminPanel() {
                if (!this.isAdmin) return;
                
                this.loadAdminDashboard();
            }
            
            loadAdminDashboard() {
                if (!this.isAdmin) return;
                
                // Estatísticas
                document.getElementById('adminTotalPilots').textContent = Object.keys(this.data.pilots).length;
                document.getElementById('adminPendingTests').textContent = Object.values(this.data.tests).filter(t => t.status === 'pending').length;
                document.getElementById('adminScheduledFlights').textContent = this.data.flights.filter(f => f.status === 'scheduled').length;
            }
            
            loadAdminPilots() {
                if (!this.isAdmin) return;
                
                const table = document.getElementById('adminPilotsTable');
                if (!table) return;
                
                const pilots = Object.values(this.data.pilots);
                
                if (pilots.length === 0) {
                    table.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #88ccff;">
                                Nenhum piloto cadastrado
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                table.innerHTML = pilots.map(pilot => `
                    <tr>
                        <td>${pilot.id}</td>
                        <td>${pilot.name}</td>
                        <td>
                            <span class="badge ${pilot.status === 'approved' ? 'badge-approved' : 
                                            pilot.status === 'pending' ? 'badge-pending' : 
                                            pilot.status === 'testing' ? 'badge-testing' : 'badge-rejected'}">
                                ${pilot.status === 'approved' ? 'APROVADO' : 
                                 pilot.status === 'pending' ? 'PENDENTE' : 
                                 pilot.status === 'testing' ? 'EM TESTE' : 'REPROVADO'}
                            </span>
                        </td>
                        <td>${pilot.score || 0}</td>
                        <td>
                            <button class="btn btn-small btn-primary" onclick="system.adminViewPilot('${pilot.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="system.adminMessagePilot('${pilot.id}')">
                                <i class="fas fa-comment"></i>
                            </button>
                            ${pilot.status !== 'approved' ? `
                                <button class="btn btn-small btn-success" onclick="system.adminAssignTest('${pilot.id}')">
                                    <i class="fas fa-vial"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `).join('');
            }
            
            loadAdminTests() {
                if (!this.isAdmin) return;
                
                const container = document.getElementById('adminTestsList');
                if (!container) return;
                
                const tests = Object.values(this.data.tests);
                
                if (tests.length === 0) {
                    container.innerHTML = `
                        <div class="card" style="text-align: center; padding: 40px;">
                            <i class="fas fa-vial" style="font-size: 3rem; color: #88ccff; margin-bottom: 15px;"></i>
                            <p style="color: #88ccff;">Nenhum teste criado</p>
                            <button class="btn btn-primary" onclick="system.createTest()" style="margin-top: 15px;">
                                <i class="fas fa-plus"></i> Criar Primeiro Teste
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = tests.map(test => `
                    <div class="card" style="margin-bottom: 15px;">
                        <div class="card-header">
                            <div class="card-title">${test.name}</div>
                            <div class="badge ${test.status === 'template' ? 'badge-pending' : 
                                              test.status === 'completed' ? 'badge-approved' : 
                                              'badge-testing'}">
                                ${test.status === 'template' ? 'TEMPLATE' : 
                                 test.status === 'completed' ? 'COMPLETO' : 'ATRIBUIDO'}
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <p><strong>ID:</strong> ${test.id}</p>
                            <p><strong>Questões:</strong> ${test.questions || 0}</p>
                            <p><strong>Pontuação mínima:</strong> ${test.passingScore || 0}</p>
                            ${test.pilotId ? `<p><strong>Piloto:</strong> ${this.data.pilots[test.pilotId]?.name || 'N/A'}</p>` : ''}
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn btn-small btn-primary" onclick="system.adminViewTest('${test.id}')">
                                <i class="fas fa-eye"></i> Ver
                            </button>
                            ${test.status === 'template' ? `
                                <button class="btn btn-small btn-success" onclick="system.adminAssignTestToPilot('${test.id}')">
                                    <i class="fas fa-user-plus"></i> Atribuir
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            loadAdminFlights() {
                if (!this.isAdmin) return;
                
                const container = document.getElementById('adminFlightsList');
                if (!container) return;
                
                if (this.data.flights.length === 0) {
                    container.innerHTML = `
                        <div class="card" style="text-align: center; padding: 40px;">
                            <i class="fas fa-plane" style="font-size: 3rem; color: #88ccff; margin-bottom: 15px;"></i>
                            <p style="color: #88ccff;">Nenhum voo agendado</p>
                            <button class="btn btn-primary" onclick="system.scheduleFlight()" style="margin-top: 15px;">
                                <i class="fas fa-plus"></i> Agendar Primeiro Voo
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = this.data.flights.map(flight => `
                    <div class="card" style="margin-bottom: 15px;">
                        <div class="card-header">
                            <div class="card-title">Voo ${flight.number}</div>
                            <div class="badge ${flight.status === 'scheduled' ? 'badge-approved' : 
                                              flight.status === 'available' ? 'badge-pending' : 
                                              'badge-rejected'}">
                                ${flight.status === 'scheduled' ? 'AGENDADO' : 
                                 flight.status === 'available' ? 'DISPONÍVEL' : 'CANCELADO'}
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <p><strong>Rota:</strong> ${flight.origin} → ${flight.destination}</p>
                            <p><strong>Data:</strong> ${new Date(flight.date).toLocaleDateString('pt-BR')} ${flight.time}</p>
                            <p><strong>Aeronave:</strong> ${flight.aircraft}</p>
                            <p><strong>Piloto:</strong> ${flight.pilotId ? this.data.pilots[flight.pilotId]?.name : 'À designar'}</p>
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn btn-small btn-primary" onclick="system.adminViewFlight('${flight.id}')">
                                <i class="fas fa-eye"></i> Ver
                            </button>
                            ${!flight.pilotId && flight.status === 'available' ? `
                                <button class="btn btn-small btn-success" onclick="system.adminAssignFlight('${flight.id}')">
                                    <i class="fas fa-user-plus"></i> Designar
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            // ==================== FUNÇÕES PÚBLICAS ====================
            setupEventListeners() {
                // Botão de trocar modo de login
                window.toggleLoginMode = () => {
                    const isAdminMode = document.getElementById('adminCodeGroup').style.display === 'block';
                    document.getElementById('adminCodeGroup').style.display = isAdminMode ? 'none' : 'block';
                    document.getElementById('loginModeText').textContent = isAdminMode ? 'Modo Piloto' : 'Modo Admin';
                };
                
                // Tentativa de login
                window.attemptLogin = () => {
                    const email = document.getElementById('loginEmail').value.trim();
                    const password = document.getElementById('loginPassword').value.trim();
                    const isAdminMode = document.getElementById('adminCodeGroup').style.display === 'block';
                    
                    if (!email || !password) {
                        this.showNotification('Preencha todos os campos', 'error');
                        return;
                    }
                    
                    if (isAdminMode) {
                        const adminCode = document.getElementById('adminCode').value.trim();
                        if (adminCode !== CONFIG.ADMIN_CODE) {
                            this.showNotification('Código administrativo incorreto', 'error');
                            return;
                        }
                        this.loginAsAdmin(email);
                    } else {
                        // Buscar piloto
                        let pilot = null;
                        for (const id in this.data.pilots) {
                            const p = this.data.pilots[id];
                            if ((p.email === email || p.id === email) && p.password === password) {
                                pilot = p;
                                break;
                            }
                        }
                        
                        if (pilot) {
                            this.loginAsPilot(pilot);
                        } else {
                            this.showNotification('Credenciais inválidas', 'error');
                        }
                    }
                };
                
                // Logout
                window.logout = () => this.logout();
                
                // Outras funções públicas
                window.showAdminLogin = () => {
                    document.getElementById('adminCodeGroup').style.display = 'block';
                    document.getElementById('loginModeText').textContent = 'Modo Admin';
                    this.showModal('loginModal');
                };
                
                window.refreshFlights = () => {
                    this.loadPilotFlights();
                    this.showNotification('Voos atualizados', 'success');
                };
                
                window.checkForTest = () => {
                    this.checkPendingTests();
                    this.showNotification('Verificando testes...', 'info');
                };
                
                window.viewLicense = () => {
                    if (!this.currentUser || this.isAdmin) return;
                    alert(`📋 CARTEIRA DE PILOTO\n\nNome: ${this.currentUser.name}\nID: ${this.currentUser.id}\nCategoria: ${this.currentUser.level || 'Aprendiz'}\nStatus: ${this.currentUser.status === 'approved' ? 'Aprovado' : 'Pendente'}\nValidade: ${this.currentUser.licenseExpiry ? new Date(this.currentUser.licenseExpiry).toLocaleDateString('pt-BR') : 'Indefinida'}`);
                };
                
                window.joinServer = () => {
                    if (!this.currentUser || this.currentUser.status !== 'approved') {
                        this.showNotification('Acesso ao servidor não liberado', 'error');
                        return;
                    }
                    window.open(CONFIG.ROBLOX_LINK, '_blank');
                };
                
                window.joinWhatsApp = () => {
                    window.open(CONFIG.WHATSAPP_LINK, '_blank');
                };
                
                window.sendChatMessage = () => {
                    const input = document.getElementById('chatInput');
                    if (!input || !input.value.trim() || !this.currentUser) return;
                    
                    const message = {
                        id: 'MSG' + Date.now(),
                        sender: this.isAdmin ? 'admin' : 'pilot',
                        pilotId: this.currentUser.id,
                        message: input.value,
                        timestamp: new Date().toISOString()
                    };
                    
                    this.data.chat.push(message);
                    this.data.saveAllData();
                    
                    input.value = '';
                    this.loadChat();
                    this.showNotification('Mensagem enviada', 'success');
                };
                
                // Funções admin
                window.createTest = () => {
                    const testName = prompt('Nome do teste:');
                    if (!testName) return;
                    
                    const testId = 'T' + Date.now();
                    this.data.tests[testId] = {
                        id: testId,
                        name: testName,
                        questions: 10,
                        passingScore: 7,
                        status: 'template',
                        createdAt: new Date().toISOString()
                    };
                    
                    this.data.saveAllData();
                    this.loadAdminTests();
                    this.showNotification(`Teste "${testName}" criado!`, 'success');
                };
                
                window.scheduleFlight = () => {
                    const flightNumber = prompt('Número do voo (ex: DL101):');
                    if (!flightNumber) return;
                    
                    const flightId = 'FL' + Date.now();
                    this.data.flights.push({
                        id: flightId,
                        number: flightNumber,
                        origin: 'SBGR - Guarulhos',
                        destination: 'KJFK - Nova York',
                        date: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                        time: '14:30',
                        aircraft: 'Boeing 777',
                        status: 'available',
                        pilotId: null,
                        createdAt: new Date().toISOString()
                    });
                    
                    this.data.saveAllData();
                    this.loadAdminFlights();
                    this.showNotification(`Voo ${flightNumber} agendado!`, 'success');
                };
                
                // Fechar modal
                window.closeModal = (modalId) => {
                    this.hideModal(modalId);
                };
                
                // Mostrar modal de registro
                window.showModal = (modalId) => {
                    this.showModal(modalId);
                };
                
                // Registrar piloto
                window.registerPilot = () => {
                    const name = document.getElementById('registerName').value.trim();
                    const email = document.getElementById('registerEmail').value.trim();
                    const roblox = document.getElementById('registerRoblox').value.trim();
                    const password = document.getElementById('registerPassword').value;
                    const confirmPassword = document.getElementById('registerConfirmPassword').value;
                    
                    if (!name || !email || !roblox || !password) {
                        this.showNotification('Preencha todos os campos obrigatórios', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        this.showNotification('A senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        this.showNotification('As senhas não coincidem', 'error');
                        return;
                    }
                    
                    // Verificar email
                    for (const id in this.data.pilots) {
                        if (this.data.pilots[id].email === email) {
                            this.showNotification('Este email já está cadastrado', 'error');
                            return;
                        }
                    }
                    
                    // Criar novo piloto
                    const pilotId = 'DL-' + (Object.keys(this.data.pilots).length + 1).toString().padStart(3, '0');
                    const newPilot = {
                        id: pilotId,
                        name: name,
                        email: email,
                        whatsapp: document.getElementById('registerWhatsApp').value.trim(),
                        roblox: roblox,
                        age: parseInt(document.getElementById('registerAge').value) || 18,
                        nationality: document.getElementById('registerNationality').value.trim() || 'Brasileiro',
                        password: password,
                        score: 0,
                        level: 'Aprendiz',
                        status: 'pending',
                        flights: [],
                        tests: [],
                        licenseExpiry: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    };
                    
                    this.data.pilots[pilotId] = newPilot;
                    this.data.saveAllData();
                    
                    this.showNotification(`✅ Cadastro realizado! Seu ID é: ${pilotId}`, 'success');
                    this.hideModal('registerModal');
                    
                    // Auto login
                    this.loginAsPilot(newPilot);
                };
            }
            
            // ==================== FUNÇÕES DE EXEMPLO ====================
            loadChat() {
                const container = document.getElementById('chatMessages');
                if (!container) return;
                
                const messages = this.data.chat.filter(msg => 
                    this.isAdmin || msg.pilotId === this.currentUser.id || msg.sender === 'admin'
                );
                
                container.innerHTML = messages.map(msg => `
                    <div class="message ${msg.sender === 'admin' ? 'admin' : 'pilot'}">
                        <strong>${msg.sender === 'admin' ? 'Administração' : (this.isAdmin ? this.data.pilots[msg.pilotId]?.name : 'Você')}:</strong> 
                        ${msg.message}
                    </div>
                `).join('');
                
                container.scrollTop = container.scrollHeight;
            }
        }
        
        // ==================== INICIALIZAÇÃO ====================
        let system;
        
        document.addEventListener('DOMContentLoaded', () => {
            system = new DeltaAirlinesSystem();
            
            // Expor sistema globalmente para funções HTML
            window.system = system;
            
            console.log('✈️ Delta Airlines RP - Sistema inicializado com sucesso!');
            console.log('⚠️ Configure o ADMIN_CODE no código se necessário');
            console.log('\n👤 Piloto de teste: joao@exemplo.com / 123456');
            console.log('👨‍✈️ Admin: qualquer email + código: DeltaAdmin2024!');
        });
    </script>
</body>
</html>
