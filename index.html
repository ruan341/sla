<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delta Airlines RP - Sistema de Licenciamento</title>
    <style>
        /* ESTILOS SIMPLIFICADOS PARA EVITAR ERROS */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        
        body {
            background: linear-gradient(135deg, #003366, #0066cc);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        header {
            background: rgba(0, 51, 102, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #ff9900;
        }
        
        h1 {
            color: #ff9900;
            margin-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(0, 68, 136, 0.8);
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: #0066cc;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
        
        .tab-btn.active {
            background: #ff9900;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: rgba(0, 51, 102, 0.9);
            border-radius: 10px;
        }
        
        .tab-content.active { display: block; }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn-primary { background: #ff9900; color: white; }
        .btn-secondary { background: #0066cc; color: white; }
        
        .card {
            background: rgba(0, 68, 136, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #003366;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            border: 2px solid #ff9900;
        }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #99ccff; }
        .form-group input { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ff9900; background: #002244; color: white; }
    </style>
</head>
<body>
    <!-- MODAL DE LOGIN -->
    <div id="loginModal" class="modal" style="display: flex;">
        <div class="modal-content">
            <h2 style="color: #ff9900; margin-bottom: 20px;">üîê LOGIN</h2>
            <div class="form-group">
                <label>E-mail ou ID</label>
                <input type="text" id="loginEmail" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label>Senha</label>
                <input type="password" id="loginPassword" placeholder="Sua senha">
            </div>
            <div class="form-group" id="adminCodeSection" style="display: none;">
                <label>C√≥digo Admin</label>
                <input type="password" id="adminCode" placeholder="C√≥digo administrativo">
            </div>
            <button class="btn btn-primary" onclick="toggleAdminLogin()" style="margin-bottom: 10px;">
                Modo: <span id="loginMode">Piloto</span>
            </button>
            <button class="btn btn-primary" onclick="attemptLogin()" style="width: 100%;">
                ENTRAR
            </button>
            <p style="text-align: center; margin-top: 15px; color: #99ccff;">
                N√£o tem conta? <a href="#" onclick="showRegisterModal()" style="color: #ff9900;">Cadastre-se</a>
            </p>
        </div>
    </div>
    
    <!-- CONTE√öDO PRINCIPAL -->
    <div id="mainContent" style="display: none;">
        <div class="container">
            <header>
                <h1>‚úàÔ∏è DELTA AIRLINES RP</h1>
                <p>Sistema de Licenciamento de Pilotos</p>
                <div class="status-bar">
                    <div>üë§ <span id="currentPilotName">-</span></div>
                    <div>üÜî <span id="currentPilotId">-</span></div>
                    <div>üìä <span id="currentPilotScore">0</span> pontos</div>
                    <button class="btn btn-secondary" onclick="logout()">Sair</button>
                </div>
            </header>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
                <button class="tab-btn" data-tab="flights">‚úàÔ∏è Meus Voos</button>
                <button class="tab-btn" data-tab="tests">üß™ Testes</button>
                <button class="tab-btn" data-tab="license">üìã Carteira</button>
                <button class="tab-btn" id="adminTab" data-tab="admin">üë®‚Äç‚úàÔ∏è Admin</button>
            </div>
            
            <!-- DASHBOARD -->
            <div id="dashboard" class="tab-content active">
                <h2>Bem-vindo, <span id="welcomeName">Piloto</span>!</h2>
                <div class="card">
                    <h3>üìà Sua Pontua√ß√£o: <span id="dashboardScore">0</span></h3>
                    <p>Status: <span id="dashboardStatus">Pendente</span></p>
                    <p>N√≠vel: <span id="dashboardLevel">Aprendiz</span></p>
                </div>
            </div>
            
            <!-- VOOS -->
            <div id="flights" class="tab-content">
                <h2>‚úàÔ∏è Meus Voos</h2>
                <div id="flightsList">
                    <div class="card">Nenhum voo agendado</div>
                </div>
            </div>
            
            <!-- TESTES -->
            <div id="tests" class="tab-content">
                <h2>üß™ Testes</h2>
                <div id="testsContent">
                    <div class="card">
                        <p>Aguardando teste ser atribu√≠do</p>
                        <button class="btn btn-primary" onclick="checkForTest()">Verificar Teste</button>
                    </div>
                </div>
            </div>
            
            <!-- CARTEIRA -->
            <div id="license" class="tab-content">
                <h2>üìã Minha Carteira</h2>
                <div class="card">
                    <p><strong>Nome:</strong> <span id="licenseName">-</span></p>
                    <p><strong>ID:</strong> <span id="licenseId">-</span></p>
                    <p><strong>Categoria:</strong> <span id="licenseCategory">-</span></p>
                    <button class="btn btn-primary" onclick="viewLicense()">Ver Carteira Completa</button>
                </div>
            </div>
            
            <!-- ADMIN -->
            <div id="admin" class="tab-content">
                <div id="adminLoginPrompt">
                    <h2>üîê √Årea Administrativa</h2>
                    <p>Fa√ßa login como administrador para acessar</p>
                    <button class="btn btn-primary" onclick="showAdminLogin()">Login Admin</button>
                </div>
                
                <div id="adminContent" style="display: none;">
                    <h2>üë®‚Äç‚úàÔ∏è Painel de Administra√ß√£o</h2>
                    
                    <div class="tabs">
                        <button class="tab-btn" data-subtab="pilots">üë• Pilotos</button>
                        <button class="tab-btn" data-subtab="tests">üß™ Testes</button>
                        <button class="tab-btn" data-subtab="flights">‚úàÔ∏è Voos</button>
                    </div>
                    
                    <!-- SUB-ABAS -->
                    <div id="adminPilots" class="admin-subtab" style="display: none;">
                        <h3>Pilotos Cadastrados: <span id="pilotCount">0</span></h3>
                        <div id="pilotsList"></div>
                    </div>
                    
                    <div id="adminTests" class="admin-subtab" style="display: none;">
                        <h3>Testes</h3>
                        <button class="btn btn-primary" onclick="createTest()">Criar Teste</button>
                        <div id="testsList"></div>
                    </div>
                    
                    <div id="adminFlights" class="admin-subtab" style="display: none;">
                        <h3>Voos</h3>
                        <button class="btn btn-primary" onclick="scheduleFlight()">Agendar Voo</button>
                        <div id="flightsAdminList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURA√á√ÉO ====================
        const CONFIG = {
            ADMIN_CODE: "admin123",
            STORAGE_KEY: "delta_airlines"
        };
        
        // ==================== VARI√ÅVEIS ====================
        let currentUser = null;
        let isAdmin = false;
        let pilots = {};
        let flights = [];
        let tests = {};
        
        // ==================== INICIALIZA√á√ÉO ====================
        function init() {
            console.log("Sistema iniciando...");
            
            // Carregar dados salvos
            loadData();
            
            // Verificar sess√£o salva
            const session = localStorage.getItem(CONFIG.STORAGE_KEY + "_session");
            if (session) {
                try {
                    const sessionData = JSON.parse(session);
                    if (sessionData.expires > Date.now()) {
                        autoLogin(sessionData);
                    }
                } catch(e) {
                    console.log("Sess√£o inv√°lida");
                }
            }
            
            // Configurar eventos
            setupEventListeners();
            
            // Mostrar login se n√£o estiver logado
            if (!currentUser) {
                showLoginModal();
            }
        }
        
        function loadData() {
            try {
                const pilotsData = localStorage.getItem(CONFIG.STORAGE_KEY + "_pilots");
                const flightsData = localStorage.getItem(CONFIG.STORAGE_KEY + "_flights");
                const testsData = localStorage.getItem(CONFIG.STORAGE_KEY + "_tests");
                
                pilots = pilotsData ? JSON.parse(pilotsData) : {};
                flights = flightsData ? JSON.parse(flightsData) : [];
                tests = testsData ? JSON.parse(testsData) : {};
                
                // Se n√£o houver dados, criar exemplos
                if (Object.keys(pilots).length === 0) {
                    createSampleData();
                }
            } catch(e) {
                console.error("Erro ao carregar dados:", e);
                pilots = {};
                flights = [];
                tests = {};
            }
        }
        
        function saveData() {
            try {
                localStorage.setItem(CONFIG.STORAGE_KEY + "_pilots", JSON.stringify(pilots));
                localStorage.setItem(CONFIG.STORAGE_KEY + "_flights", JSON.stringify(flights));
                localStorage.setItem(CONFIG.STORAGE_KEY + "_tests", JSON.stringify(tests));
            } catch(e) {
                console.error("Erro ao salvar:", e);
            }
        }
        
        function createSampleData() {
            // Piloto de exemplo
            pilots["DL-001"] = {
                id: "DL-001",
                name: "Jo√£o Silva",
                email: "joao@exemplo.com",
                password: "123456",
                score: 100,
                status: "approved",
                level: "Piloto Jr"
            };
            
            // Piloto pendente
            pilots["DL-002"] = {
                id: "DL-002",
                name: "Maria Santos",
                email: "maria@exemplo.com",
                password: "123456",
                score: 0,
                status: "pending",
                level: "Aprendiz"
            };
            
            // Voo de exemplo
            flights.push({
                id: "flight1",
                number: "DL101",
                origin: "S√£o Paulo",
                destination: "Nova York",
                date: "2024-12-15",
                time: "14:30",
                pilotId: "DL-001",
                status: "scheduled"
            });
            
            // Teste de exemplo
            tests["test1"] = {
                id: "test1",
                name: "Teste B√°sico",
                pilotId: "DL-002",
                status: "pending"
            };
            
            saveData();
        }
        
        // ==================== LOGIN ====================
        let loginMode = 'pilot';
        
        function toggleAdminLogin() {
            loginMode = loginMode === 'pilot' ? 'admin' : 'pilot';
            document.getElementById('loginMode').textContent = loginMode === 'admin' ? 'Admin' : 'Piloto';
            document.getElementById('adminCodeSection').style.display = loginMode === 'admin' ? 'block' : 'none';
        }
        
        function attemptLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!email || !password) {
                alert("Preencha todos os campos");
                return;
            }
            
            if (loginMode === 'admin') {
                const adminCode = document.getElementById('adminCode').value.trim();
                if (adminCode !== CONFIG.ADMIN_CODE) {
                    alert("C√≥digo administrativo incorreto");
                    return;
                }
                
                // Login como admin
                isAdmin = true;
                currentUser = {
                    id: "ADMIN",
                    name: "Administrador",
                    email: email,
                    isAdmin: true
                };
                
                saveSession();
                showMainContent();
                unlockAdminPanel();
                
            } else {
                // Login como piloto
                let pilotFound = null;
                
                for (const id in pilots) {
                    const pilot = pilots[id];
                    if ((pilot.email === email || pilot.id === email) && pilot.password === password) {
                        pilotFound = pilot;
                        break;
                    }
                }
                
                if (pilotFound) {
                    currentUser = pilotFound;
                    isAdmin = false;
                    saveSession();
                    showMainContent();
                } else {
                    alert("Credenciais inv√°lidas");
                }
            }
        }
        
        function autoLogin(sessionData) {
            if (sessionData.isAdmin) {
                isAdmin = true;
                currentUser = {
                    id: "ADMIN",
                    name: "Administrador",
                    email: sessionData.email,
                    isAdmin: true
                };
                showMainContent();
                unlockAdminPanel();
            } else {
                const pilot = pilots[sessionData.userId];
                if (pilot && pilot.password === sessionData.password) {
                    currentUser = pilot;
                    isAdmin = false;
                    showMainContent();
                }
            }
        }
        
        function saveSession() {
            const session = {
                userId: currentUser.id,
                email: currentUser.email,
                password: currentUser.password,
                isAdmin: isAdmin,
                expires: Date.now() + (7 * 24 * 60 * 60 * 1000) // 7 dias
            };
            localStorage.setItem(CONFIG.STORAGE_KEY + "_session", JSON.stringify(session));
        }
        
        function logout() {
            currentUser = null;
            isAdmin = false;
            document.getElementById('mainContent').style.display = 'none';
            localStorage.removeItem(CONFIG.STORAGE_KEY + "_session");
            showLoginModal();
        }
        
        // ==================== INTERFACE ====================
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }
        
        function showMainContent() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            updateUserInfo();
            loadDashboard();
        }
        
        function updateUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('currentPilotName').textContent = currentUser.name;
            document.getElementById('currentPilotId').textContent = currentUser.id;
            document.getElementById('currentPilotScore').textContent = currentUser.score || 0;
            document.getElementById('welcomeName').textContent = currentUser.name;
            document.getElementById('dashboardScore').textContent = currentUser.score || 0;
            document.getElementById('dashboardStatus').textContent = currentUser.status || "Pendente";
            document.getElementById('dashboardLevel').textContent = currentUser.level || "Aprendiz";
            document.getElementById('licenseName').textContent = currentUser.name;
            document.getElementById('licenseId').textContent = currentUser.id;
            document.getElementById('licenseCategory').textContent = currentUser.level || "Aprendiz";
        }
        
        function setupEventListeners() {
            // Abas principais
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    if (tabId === 'admin' && !isAdmin) {
                        showAdminLogin();
                        return;
                    }
                    
                    // Remover active de todos
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Ativar aba clicada
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Carregar conte√∫do da aba
                    switch(tabId) {
                        case 'dashboard':
                            loadDashboard();
                            break;
                        case 'flights':
                            loadFlights();
                            break;
                        case 'tests':
                            loadTests();
                            break;
                        case 'admin':
                            if (isAdmin) loadAdminPanel();
                            break;
                    }
                });
            });
            
            // Sub-abas do admin
            document.querySelectorAll('[data-subtab]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const subtabId = this.dataset.subtab;
                    
                    // Esconder todas sub-abas
                    document.querySelectorAll('.admin-subtab').forEach(tab => {
                        tab.style.display = 'none';
                    });
                    
                    // Mostrar sub-aba selecionada
                    document.getElementById('admin' + subtabId.charAt(0).toUpperCase() + subtabId.slice(1)).style.display = 'block';
                    
                    // Carregar conte√∫do
                    switch(subtabId) {
                        case 'pilots':
                            loadAdminPilots();
                            break;
                        case 'tests':
                            loadAdminTests();
                            break;
                        case 'flights':
                            loadAdminFlights();
                            break;
                    }
                });
            });
        }
        
        // ==================== FUN√á√ïES DO PILOTO ====================
        function loadDashboard() {
            // J√° atualizado por updateUserInfo()
        }
        
        function loadFlights() {
            if (!currentUser || isAdmin) return;
            
            const pilotFlights = flights.filter(f => f.pilotId === currentUser.id);
            const container = document.getElementById('flightsList');
            
            if (pilotFlights.length === 0) {
                container.innerHTML = '<div class="card">Nenhum voo agendado</div>';
                return;
            }
            
            container.innerHTML = pilotFlights.map(flight => `
                <div class="card">
                    <h4>‚úàÔ∏è Voo ${flight.number}</h4>
                    <p>${flight.origin} ‚Üí ${flight.destination}</p>
                    <p>üìÖ ${flight.date} ${flight.time}</p>
                    <p>Status: ${flight.status}</p>
                </div>
            `).join('');
        }
        
        function loadTests() {
            if (!currentUser || isAdmin) return;
            
            const pilotTests = Object.values(tests).filter(t => t.pilotId === currentUser.id);
            const container = document.getElementById('testsContent');
            
            if (pilotTests.length === 0) {
                container.innerHTML = `
                    <div class="card">
                        <p>Nenhum teste atribu√≠do</p>
                        <button class="btn btn-primary" onclick="checkForTest()">Verificar Teste</button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pilotTests.map(test => `
                <div class="card">
                    <h4>üß™ ${test.name}</h4>
                    <p>Status: ${test.status || 'Pendente'}</p>
                    ${test.status === 'pending' ? `
                        <button class="btn btn-primary" onclick="startTest('${test.id}')">Iniciar Teste</button>
                    ` : ''}
                </div>
            `).join('');
        }
        
        function checkForTest() {
            alert("Nenhum teste dispon√≠vel no momento. Aguarde atribui√ß√£o do administrador.");
        }
        
        function viewLicense() {
            alert(`CARTEIRA DE PILOTO\n\nNome: ${currentUser.name}\nID: ${currentUser.id}\nCategoria: ${currentUser.level || 'Aprendiz'}\nPontua√ß√£o: ${currentUser.score || 0}`);
        }
        
        // ==================== FUN√á√ïES DO ADMIN ====================
        function showAdminLogin() {
            loginMode = 'admin';
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('adminCodeSection').style.display = 'block';
            document.getElementById('loginMode').textContent = 'Admin';
        }
        
        function unlockAdminPanel() {
            document.getElementById('adminLoginPrompt').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            document.getElementById('adminTab').classList.remove('locked');
            loadAdminPanel();
        }
        
        function loadAdminPanel() {
            if (!isAdmin) return;
            
            // Atualizar contagem de pilotos
            document.getElementById('pilotCount').textContent = Object.keys(pilots).length;
            
            // Mostrar primeira sub-aba
            document.getElementById('adminPilots').style.display = 'block';
            loadAdminPilots();
        }
        
        function loadAdminPilots() {
            if (!isAdmin) return;
            
            const container = document.getElementById('pilotsList');
            const pilotList = Object.values(pilots);
            
            if (pilotList.length === 0) {
                container.innerHTML = '<div class="card">Nenhum piloto cadastrado</div>';
                return;
            }
            
            container.innerHTML = pilotList.map(pilot => `
                <div class="card" style="margin: 10px 0;">
                    <h4>üë§ ${pilot.name}</h4>
                    <p>ID: ${pilot.id}</p>
                    <p>Status: ${pilot.status}</p>
                    <p>Pontua√ß√£o: ${pilot.score || 0}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-secondary" onclick="messagePilot('${pilot.id}')">Mensagem</button>
                        <button class="btn btn-primary" onclick="assignTestToPilot('${pilot.id}')">Atribuir Teste</button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadAdminTests() {
            if (!isAdmin) return;
            
            const container = document.getElementById('testsList');
            const testList = Object.values(tests);
            
            if (testList.length === 0) {
                container.innerHTML = '<div class="card">Nenhum teste criado</div>';
                return;
            }
            
            container.innerHTML = testList.map(test => `
                <div class="card" style="margin: 10px 0;">
                    <h4>üß™ ${test.name}</h4>
                    <p>ID: ${test.id}</p>
                    <p>Piloto: ${pilots[test.pilotId]?.name || 'N√£o atribu√≠do'}</p>
                    <p>Status: ${test.status || 'Pendente'}</p>
                </div>
            `).join('');
        }
        
        function loadAdminFlights() {
            if (!isAdmin) return;
            
            const container = document.getElementById('flightsAdminList');
            
            if (flights.length === 0) {
                container.innerHTML = '<div class="card">Nenhum voo agendado</div>';
                return;
            }
            
            container.innerHTML = flights.map(flight => `
                <div class="card" style="margin: 10px 0;">
                    <h4>‚úàÔ∏è Voo ${flight.number}</h4>
                    <p>${flight.origin} ‚Üí ${flight.destination}</p>
                    <p>üìÖ ${flight.date} ${flight.time}</p>
                    <p>Piloto: ${pilots[flight.pilotId]?.name || 'N√£o designado'}</p>
                    <p>Status: ${flight.status}</p>
                </div>
            `).join('');
        }
        
        function createTest() {
            const testName = prompt("Nome do teste:");
            if (!testName) return;
            
            const testId = "test_" + Date.now();
            tests[testId] = {
                id: testId,
                name: testName,
                status: "template"
            };
            
            saveData();
            loadAdminTests();
            alert("Teste criado com sucesso!");
        }
        
        function scheduleFlight() {
            const flightNumber = prompt("N√∫mero do voo:");
            if (!flightNumber) return;
            
            flights.push({
                id: "flight_" + Date.now(),
                number: flightNumber,
                origin: "S√£o Paulo",
                destination: "Rio de Janeiro",
                date: "2024-12-20",
                time: "10:00",
                status: "available"
            });
            
            saveData();
            loadAdminFlights();
            alert("Voo agendado!");
        }
        
        function assignTestToPilot(pilotId) {
            const pilot = pilots[pilotId];
            if (!pilot) return;
            
            // Encontrar um teste template
            const availableTest = Object.values(tests).find(t => t.status === "template");
            
            if (!availableTest) {
                alert("Crie um teste primeiro!");
                return;
            }
            
            // Criar c√≥pia do teste para o piloto
            const testId = "test_" + Date.now() + "_" + pilotId;
            tests[testId] = {
                ...availableTest,
                id: testId,
                pilotId: pilotId,
                status: "pending"
            };
            
            // Atualizar status do piloto
            pilot.status = "testing";
            pilots[pilotId] = pilot;
            
            saveData();
            loadAdminPilots();
            alert(`Teste atribu√≠do a ${pilot.name}`);
        }
        
        function messagePilot(pilotId) {
            const pilot = pilots[pilotId];
            if (!pilot) return;
            
            const message = prompt(`Digite a mensagem para ${pilot.name}:`);
            if (message) {
                alert(`Mensagem enviada para ${pilot.name}:\n\n"${message}"`);
            }
        }
        
        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
